# 1.3 运算符与表达式

## 目录
- [算术运算符](#算术运算符)
- [关系运算符](#关系运算符)
- [逻辑运算符](#逻辑运算符)
- [位运算符](#位运算符)
- [赋值运算符](#赋值运算符)
- [条件运算符](#条件运算符)
- [运算符优先级](#运算符优先级)

---

## 算术运算符

### 基本算术运算符

| 运算符 | 描述 | 示例 |
|--------|------|------|
| `+` | 加法 | `a + b` |
| `-` | 减法 | `a - b` |
| `*` | 乘法 | `a * b` |
| `/` | 除法 | `a / b` |
| `%` | 取模（求余） | `a % b` |

### 基本示例

```cpp
#include <iostream>

int main() {
    int a = 10, b = 3;

    std::cout << "a = " << a << ", b = " << b << "\n";
    std::cout << "a + b = " << a + b << "\n";   // 13
    std::cout << "a - b = " << a - b << "\n";   // 7
    std::cout << "a * b = " << a * b << "\n";   // 30
    std::cout << "a / b = " << a / b << "\n";   // 3 (整数除法)
    std::cout << "a % b = " << a % b << "\n";   // 1 (余数)

    // 浮点除法
    double x = 10.0, y = 3.0;
    std::cout << "x / y = " << x / y << "\n";   // 3.33333

    return 0;
}
```

### 自增和自减运算符

```cpp
#include <iostream>

int main() {
    int a = 5;

    // 前缀：先自增，再使用
    ++a;  // a变为6
    std::cout << "前缀 ++a: " << a << "\n";

    // 后缀：先使用，再自增
    int b = a++;  // b获得a的值(6)，然后a变为7
    std::cout << "a = " << a << ", b = " << b << "\n";

    // 自减同理
    --a;  // a变为6
    int c = a--;  // c获得a的值(6)，然后a变为5
    std::cout << "a = " << a << ", c = " << c << "\n";

    return 0;
}
```

### 整数除法注意事项

```cpp
#include <iostream>

int main() {
    // ⚠️ 整数除法会截断小数部分
    int a = 7, b = 2;
    std::cout << "7 / 2 = " << a / b << "\n";  // 3（不是3.5）

    // ✅ 正确的浮点除法
    std::cout << "7.0 / 2 = " << 7.0 / 2 << "\n";  // 3.5

    // 或者使用类型转换
    std::cout << "(double)7 / 2 = " << (double)a / b << "\n";  // 3.5

    return 0;
}
```

---

## 关系运算符

### 关系运算符列表

| 运算符 | 描述 | 示例 |
|--------|------|------|
| `==` | 等于 | `a == b` |
| `!=` | 不等于 | `a != b` |
| `<` | 小于 | `a < b` |
| `>` | 大于 | `a > b` |
| `<=` | 小于等于 | `a <= b` |
| `>=` | 大于等于 | `a >= b` |

### 示例代码

```cpp
#include <iostream>

int main() {
    int a = 5, b = 10;

    std::cout << "a = " << a << ", b = " << b << "\n";
    std::cout << "a == b: " << (a == b) << "\n";  // 0 (false)
    std::cout << "a != b: " << (a != b) << "\n";  // 1 (true)
    std::cout << "a < b: " << (a < b) << "\n";    // 1 (true)
    std::cout << "a > b: " << (a > b) << "\n";    // 0 (false)
    std::cout << "a <= b: " << (a <= b) << "\n";  // 1 (true)
    std::cout << "a >= b: " << (a >= b) << "\n";  // 0 (false)

    return 0;
}
```

### 常见陷阱

```cpp
#include <iostream>

int main() {
    // ⚠️ 错误：使用=而非==
    int a = 5;
    if (a = 10) {  // 这是赋值，不是比较！
        std::cout << "这会总是执行\n";
    }

    // ✅ 正确：使用==
    if (a == 10) {
        std::cout << "a等于10\n";
    }

    // ✅ 最佳实践：将常量放在左边
    if (10 == a) {  // 如果写成10=a会报错
        std::cout << "a等于10\n";
    }

    return 0;
}
```

---

## 逻辑运算符

### 逻辑运算符列表

| 运算符 | 描述 | 示例 |
|--------|------|------|
| `&&` | 逻辑与（AND） | `a && b` |
| `\|\|` | 逻辑或（OR） | `a \|\| b` |
| `!` | 逻辑非（NOT） | `!a` |

### 真值表

#### 逻辑与 (&&)

| A | B | A && B |
|---|---|--------|
| true | true | true |
| true | false | false |
| false | true | false |
| false | false | false |

#### 逻辑或 (||)

| A | B | A \|\| B |
|---|---|----------|
| true | true | true |
| true | false | true |
| false | true | true |
| false | false | false |

#### 逻辑非 (!)

| A | !A |
|---|-----|
| true | false |
| false | true |

### 示例代码

```cpp
#include <iostream>

int main() {
    bool a = true, b = false;

    std::cout << "a = " << a << ", b = " << b << "\n";
    std::cout << "a && b: " << (a && b) << "\n";   // 0 (false)
    std::cout << "a || b: " << (a || b) << "\n";   // 1 (true)
    std::cout << "!a: " << (!a) << "\n";           // 0 (false)

    // 实际应用
    int age = 25;
    bool hasLicense = true;

    bool canDrive = (age >= 18) && hasLicense;
    std::cout << "可以驾驶: " << canDrive << "\n";

    return 0;
}
```

### 短路求值

```cpp
#include <iostream>

bool func1() {
    std::cout << "func1 被调用\n";
    return true;
}

bool func2() {
    std::cout << "func2 被调用\n";
    return false;
}

int main() {
    std::cout << "测试 &&:\n";
    bool result1 = func2() && func1();  // func2返回false，func1不会被调用
    std::cout << "结果: " << result1 << "\n\n";

    std::cout << "测试 ||:\n";
    bool result2 = func1() || func2();  // func1返回true，func2不会被调用
    std::cout << "结果: " << result2 << "\n";

    return 0;
}
```

---

## 位运算符

### 位运算符列表

| 运算符 | 描述 | 示例 |
|--------|------|------|
| `&` | 按位与 | `a & b` |
| `\|` | 按位或 | `a \| b` |
| `^` | 按位异或 | `a ^ b` |
| `~` | 按位取反 | `~a` |
| `<<` | 左移 | `a << n` |
| `>>` | 右移 | `a >> n` |

### 位运算示意图

```mermaid
graph TD
    A[按位与 &] --> B["两个位都为1时结果为1"]
    C[按位或 \|] --> D["至少一个位为1时结果为1"]
    E[按位异或 ^] --> F["两个位不同时结果为1"]
    G[按位取反 ~] --> H["0变1，1变0"]
    I[左移 <<] --> J["各位向左移动"]
    K[右移 >>] --> L["各位向右移动"]
```

### 示例代码

```cpp
#include <iostream>

int main() {
    unsigned int a = 5;  // 二进制: 101
    unsigned int b = 3;  // 二进制: 011

    std::cout << "a = " << a << " (二进制: 101)\n";
    std::cout << "b = " << b << " (二进制: 011)\n\n";

    std::cout << "a & b = " << (a & b) << " (001)\n";  // 1
    std::cout << "a | b = " << (a | b) << " (111)\n";  // 7
    std::cout << "a ^ b = " << (a ^ b) << " (110)\n";  // 6
    std::cout << "~a = " << (~a) << "\n";              // 取反

    std::cout << "\n左移和右移:\n";
    std::cout << "a << 1 = " << (a << 1) << " (1010 = 10)\n";
    std::cout << "a >> 1 = " << (a >> 1) << " (10 = 2)\n";

    return 0;
}
```

### 位运算应用

```cpp
#include <iostream>

int main() {
    // 设置某一位
    unsigned char flag = 0b00000000;
    flag |= 0b00000100;  // 设置第3位
    std::cout << "设置第3位: " << (int)flag << "\n";

    // 清除某一位
    flag &= ~0b00000100;  // 清除第3位
    std::cout << "清除第3位: " << (int)flag << "\n";

    // 检查某一位
    bool isSet = flag & 0b00000100;
    std::cout << "第3位是否设置: " << isSet << "\n";

    // 切换某一位
    flag ^= 0b00000100;  // 切换第3位
    std::cout << "切换第3位: " << (int)flag << "\n";

    return 0;
}
```

---

## 赋值运算符

### 赋值运算符列表

| 运算符 | 描述 | 等价于 |
|--------|------|--------|
| `=` | 简单赋值 | `a = b` |
| `+=` | 加且赋值 | `a += b` → `a = a + b` |
| `-=` | 减且赋值 | `a -= b` → `a = a - b` |
| `*=` | 乘且赋值 | `a *= b` → `a = a * b` |
| `/=` | 除且赋值 | `a /= b` → `a = a / b` |
| `%=` | 取模且赋值 | `a %= b` → `a = a % b` |
| `&=` | 按位与且赋值 | `a &= b` → `a = a & b` |
| `\|=` | 按位或且赋值 | `a \|= b` → `a = a \| b` |
| `^=` | 按位异或且赋值 | `a ^= b` → `a = a ^ b` |
| `<<=` | 左移且赋值 | `a <<= b` → `a = a << b` |
| `>>=` | 右移且赋值 | `a >>= b` → `a = a >> b` |

### 示例代码

```cpp
#include <iostream>

int main() {
    int a = 10;

    std::cout << "初始值: a = " << a << "\n";

    a += 5;  // a = a + 5 = 15
    std::cout << "a += 5: " << a << "\n";

    a -= 3;  // a = a - 3 = 12
    std::cout << "a -= 3: " << a << "\n";

    a *= 2;  // a = a * 2 = 24
    std::cout << "a *= 2: " << a << "\n";

    a /= 4;  // a = a / 4 = 6
    std::cout << "a /= 4: " << a << "\n";

    a %= 4;  // a = a % 4 = 2
    std::cout << "a %= 4: " << a << "\n";

    return 0;
}
```

### 链式赋值

```cpp
#include <iostream>

int main() {
    int a, b, c;

    // 链式赋值（从右到左）
    a = b = c = 10;

    std::cout << "a = " << a << "\n";
    std::cout << "b = " << b << "\n";
    std::cout << "c = " << c << "\n";

    return 0;
}
```

---

## 条件运算符

### 三元运算符语法

```cpp
condition ? expression1 : expression2
```

如果`condition`为真，返回`expression1`，否则返回`expression2`。

### 示例代码

```cpp
#include <iostream>

int main() {
    int a = 10, b = 20;

    // 基本用法
    int max = (a > b) ? a : b;
    std::cout << "最大值: " << max << "\n";

    // 嵌套使用
    int x = 15, y = 25, z = 5;
    int maxOfThree = (x > y) ?
                     ((x > z) ? x : z) :
                     ((y > z) ? y : z);
    std::cout << "三个数的最大值: " << maxOfThree << "\n";

    // 与赋值结合
    int absValue = (x < 0) ? -x : x;
    std::cout << "绝对值: " << absValue << "\n";

    return 0;
}
```

### 条件运算符 vs if-else

```cpp
// 使用条件运算符（简洁）
int max = (a > b) ? a : b;

// 等价的if-else（更易读）
int max;
if (a > b) {
    max = a;
} else {
    max = b;
}
```

---

## 运算符优先级

### 优先级表（从高到低）

| 优先级 | 运算符 | 描述 | 结合性 |
|--------|--------|------|--------|
| 1 | `::` | 作用域解析 | 从左到右 |
| 2 | `()`, `[]`, `->`, `.`, `++`, `--` | 后缀运算符、成员访问 | 从左到右 |
| 3 | `++`, `--`, `!`, `~`, `+`, `-`, `*`, `&`, `sizeof`, `new`, `delete` | 前缀运算符 | 从右到左 |
| 4 | `.*`, `->*` | 成员指针访问 | 从左到右 |
| 5 | `*`, `/`, `%` | 乘法、除法、取模 | 从左到右 |
| 6 | `+`, `-` | 加法、减法 | 从左到右 |
| 7 | `<<`, `>>` | 位左移、位右移 | 从左到右 |
| 8 | `<`, `<=`, `>`, `>=` | 关系比较 | 从左到右 |
| 9 | `==`, `!=` | 相等比较 | 从左到右 |
| 10 | `&` | 按位与 | 从左到右 |
| 11 | `^` | 按位异或 | 从左到右 |
| 12 | `\|` | 按位或 | 从左到右 |
| 13 | `&&` | 逻辑与 | 从左到右 |
| 14 | `\|\|` | 逻辑或 | 从左到右 |
| 15 | `?:` | 条件运算符 | 从右到左 |
| 16 | `=`, `+=`, `-=`等 | 赋值运算符 | 从右到左 |
| 17 | `,` | 逗号运算符 | 从左到右 |

### 优先级示例

```cpp
#include <iostream>

int main() {
    int a = 5, b = 10, c = 15;

    // 乘法优先级高于加法
    int result1 = a + b * c;  // 5 + (10 * 15) = 155
    std::cout << "a + b * c = " << result1 << "\n";

    // 使用括号改变优先级
    int result2 = (a + b) * c;  // (5 + 10) * 15 = 225
    std::cout << "(a + b) * c = " << result2 << "\n";

    // 关系运算符优先级高于逻辑运算符
    bool result3 = a < b && b < c;  // (a < b) && (b < c) = true
    std::cout << "a < b && b < c = " << result3 << "\n";

    // 赋值运算符优先级较低
    int x = 0;
    if (x = 5) {  // ⚠️ 这是赋值，不是比较！
        std::cout << "x被赋值为" << x << "\n";
    }

    return 0;
}
```

### 运算符优先级最佳实践

```cpp
#include <iostream>

int main() {
    int a = 10, b = 5, c = 2;

    // ❌ 不推荐：依赖默认优先级
    int result1 = a + b * c - a / b;

    // ✅ 推荐：使用括号明确意图
    int result2 = a + (b * c) - (a / b);

    std::cout << "result: " << result2 << "\n";

    // 复杂表达式的处理
    bool condition = (a > b) && (c != 0) || (a == 10);

    return 0;
}
```

---

## 小结

本节介绍了C++的运算符与表达式：

1. **算术运算符**：
   - 基本运算：`+`, `-`, `*`, `/`, `%`
   - 自增自减：`++`, `--`
   - 注意整数除法的截断行为

2. **关系运算符**：
   - 比较：`==`, `!=`, `<`, `>`, `<=`, `>=`
   - 避免混淆`=`和`==`

3. **逻辑运算符**：
   - 逻辑运算：`&&`, `||`, `!`
   - 短路求值特性

4. **位运算符**：
   - 位操作：`&`, `|`, `^`, `~`, `<<`, `>>`
   - 常用于标志位操作

5. **赋值运算符**：
   - 复合赋值：`+=`, `-=`, `*=`, `/=`等
   - 链式赋值

6. **条件运算符**：
   - 三元运算符：`? :`
   - 简化if-else逻辑

7. **运算符优先级**：
   - 了解优先级顺序
   - 使用括号提高可读性

## 练习

1. ✅ 编写程序计算两个数的最大值和最小值
2. ✅ 使用位运算符实现标志位的设置、清除和切换
3. ✅ 练习运算符优先级，预测表达式结果
4. ✅ 使用条件运算符简化代码

---

## 下一节
[1.4 流程控制](./1.4-流程控制.md) → 学习如何控制程序的执行流程。
