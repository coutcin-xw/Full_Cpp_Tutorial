# 1.4 流程控制

## 目录
- [条件语句](#条件语句)
- [循环语句](#循环语句)
- [跳转语句](#跳转语句)
- [范围for循环（C++11）](#范围for循环c11)

---

## 条件语句

### if语句

#### 基本if语句

```cpp
#include <iostream>

int main() {
    int score = 85;

    // 单分支if
    if (score >= 60) {
        std::cout << "及格了！\n";
    }

    // if-else双分支
    if (score >= 90) {
        std::cout << "优秀！\n";
    } else {
        std::cout << "继续努力！\n";
    }

    return 0;
}
```

#### 多分支if-else if

```cpp
#include <iostream>

int main() {
    int score = 85;

    // 多分支if-else if
    if (score >= 90) {
        std::cout << "等级: A\n";
    } else if (score >= 80) {
        std::cout << "等级: B\n";
    } else if (score >= 70) {
        std::cout << "等级: C\n";
    } else if (score >= 60) {
        std::cout << "等级: D\n";
    } else {
        std::cout << "等级: F\n";
    }

    return 0;
}
```

#### 嵌套if语句

```cpp
#include <iostream>

int main() {
    int age = 25;
    bool hasLicense = true;

    // 嵌套if
    if (age >= 18) {
        if (hasLicense) {
            std::cout << "可以驾驶\n";
        } else {
            std::cout << "需要先考驾照\n";
        }
    } else {
        std::cout << "年龄未到18岁\n";
    }

    return 0;
}
```

### switch语句

#### 基本switch语法

```cpp
#include <iostream>

int main() {
    int day = 3;

    switch (day) {
        case 1:
            std::cout << "星期一\n";
            break;
        case 2:
            std::cout << "星期二\n";
            break;
        case 3:
            std::cout << "星期三\n";
            break;
        case 4:
            std::cout << "星期四\n";
            break;
        case 5:
            std::cout << "星期五\n";
            break;
        case 6:
            std::cout << "星期六\n";
            break;
        case 7:
            std::cout << "星期日\n";
            break;
        default:
            std::cout << "无效的天数\n";
    }

    return 0;
}
```

#### switch的fall-through特性

```cpp
#include <iostream>

int main() {
    int month = 2;

    // fall-through：多个case共享同一代码块
    switch (month) {
        case 1:
        case 3:
        case 5:
        case 7:
        case 8:
        case 10:
        case 12:
            std::cout << "31天\n";
            break;
        case 4:
        case 6:
        case 9:
        case 11:
            std::cout << "30天\n";
            break;
        case 2:
            std::cout << "28或29天\n";
            break;
        default:
            std::cout << "无效月份\n";
    }

    return 0;
}
```

#### if vs switch

```cpp
// ✅ switch适合：离散的、确定值匹配
switch (dayOfWeek) {
    case 1: /* ... */ break;
    case 2: /* ... */ break;
    // ...
}

// ✅ if适合：范围判断、复杂条件
if (score >= 90 && score <= 100) {
    std::cout << "A\n";
} else if (score >= 80) {
    std::cout << "B\n";
}
```

---

## 循环语句

### while循环

#### 基本while循环

```cpp
#include <iostream>

int main() {
    int count = 0;

    // while循环：先判断后执行
    while (count < 5) {
        std::cout << "count = " << count << "\n";
        count++;  // ⚠️ 不要忘记更新循环变量
    }

    return 0;
}
```

#### 使用while进行输入验证

```cpp
#include <iostream>

int main() {
    int number;

    // 输入验证：直到用户输入有效值
    std::cout << "请输入1-100之间的数字: ";
    std::cin >> number;

    while (number < 1 || number > 100) {
        std::cout << "无效输入！请重新输入: ";
        std::cin >> number;
    }

    std::cout << "你输入的是: " << number << "\n";

    return 0;
}
```

### do-while循环

```cpp
#include <iostream>

int main() {
    int count = 0;

    // do-while循环：先执行后判断（至少执行一次）
    do {
        std::cout << "count = " << count << "\n";
        count++;
    } while (count < 5);

    return 0;
}
```

#### while vs do-while

```cpp
// while: 可能一次都不执行
int i = 10;
while (i < 5) {
    std::cout << "这不会执行\n";
    i++;
}

// do-while: 至少执行一次
int j = 10;
do {
    std::cout << "这会执行一次\n";
    j++;
} while (j < 5);
```

### for循环

#### 基本for循环

```cpp
#include <iostream>

int main() {
    // for循环语法：for(初始化; 条件; 更新)
    for (int i = 0; i < 5; i++) {
        std::cout << "i = " << i << "\n";
    }

    // 等价的while循环
    int i = 0;
    while (i < 5) {
        std::cout << "i = " << i << "\n";
        i++;
    }

    return 0;
}
```

#### for循环的灵活性

```cpp
#include <iostream>

int main() {
    // 多个初始化和更新
    for (int i = 0, j = 10; i < j; i++, j--) {
        std::cout << "i = " << i << ", j = " << j << "\n";
    }

    // 省略各个部分（无限循环）
    int count = 0;
    for (;;) {
        std::cout << "count = " << count << "\n";
        count++;
        if (count >= 5) break;
    }

    return 0;
}
```

#### 嵌套循环

```cpp
#include <iostream>

int main() {
    // 打印乘法表
    for (int i = 1; i <= 9; i++) {
        for (int j = 1; j <= i; j++) {
            std::cout << j << "×" << i << "=" << i * j << "\t";
        }
        std::cout << "\n";
    }

    return 0;
}
```

---

## 跳转语句

### break语句

```cpp
#include <iostream>

int main() {
    // 在循环中使用break
    for (int i = 0; i < 10; i++) {
        if (i == 5) {
            break;  // 退出循环
        }
        std::cout << "i = " << i << "\n";
    }
    // 输出：0, 1, 2, 3, 4

    // 在switch中使用break
    int choice = 2;
    switch (choice) {
        case 1:
            std::cout << "选项1\n";
            break;
        case 2:
            std::cout << "选项2\n";
            break;  // 防止fall-through
        default:
            std::cout << "其他选项\n";
    }

    return 0;
}
```

### continue语句

```cpp
#include <iostream>

int main() {
    // 使用continue跳过偶数
    for (int i = 0; i < 10; i++) {
        if (i % 2 == 0) {
            continue;  // 跳过本次迭代的剩余部分
        }
        std::cout << "奇数: " << i << "\n";
    }
    // 输出：1, 3, 5, 7, 9

    return 0;
}
```

### goto语句

```cpp
#include <iostream>

int main() {
    int count = 0;

    // ⚠️ goto：谨慎使用，通常不推荐
start:
    std::cout << "count = " << count << "\n";
    count++;

    if (count < 5) {
        goto start;  // 跳转到start标签
    }

    // 更好的替代方案：使用while或for循环
    for (int i = 0; i < 5; i++) {
        std::cout << "count = " << i << "\n";
    }

    return 0;
}
```

#### goto的合理使用场景

```cpp
#include <iostream>

void process() {
    int* data1 = new int[100];
    int* data2 = new int[100];

    // 如果处理失败，跳转到清理代码
    bool error = true;
    if (error) {
        goto cleanup;  // 跳转到资源清理
    }

    // 正常处理...

cleanup:
    delete[] data1;
    delete[] data2;
}

int main() {
    process();
    return 0;
}
```

---

## 范围for循环（C++11）

### 基本语法

```cpp
#include <iostream>
#include <vector>

int main() {
    // 使用数组
    int arr[] = {1, 2, 3, 4, 5};

    // 传统for循环
    for (int i = 0; i < 5; i++) {
        std::cout << arr[i] << " ";
    }
    std::cout << "\n";

    // 范围for循环（只读）
    for (int num : arr) {
        std::cout << num << " ";
    }
    std::cout << "\n";

    // 使用vector
    std::vector<int> vec = {10, 20, 30, 40, 50};

    // 范围for循环
    for (int val : vec) {
        std::cout << val << " ";
    }
    std::cout << "\n";

    return 0;
}
```

### 引用和const引用

```cpp
#include <iostream>
#include <vector>

int main() {
    std::vector<int> vec = {1, 2, 3, 4, 5};

    // 使用引用修改元素
    for (int& num : vec) {
        num *= 2;  // 每个元素乘以2
    }

    // 使用const引用只读访问（避免拷贝）
    for (const int& num : vec) {
        std::cout << num << " ";
    }
    std::cout << "\n";

    return 0;
}
```

### 范围for循环的应用

```cpp
#include <iostream>
#include <string>

int main() {
    std::string str = "Hello";

    // 遍历字符串
    for (char c : str) {
        std::cout << c << "-";
    }
    std::cout << "\n";

    // 计算总和
    std::vector<int> numbers = {1, 2, 3, 4, 5};
    int sum = 0;
    for (int num : numbers) {
        sum += num;
    }
    std::cout << "总和: " << sum << "\n";

    return 0;
}
```

---

## 控制流综合示例

### 示例1：计算器程序

```cpp
#include <iostream>

int main() {
    double num1, num2;
    char op;
    bool continueCalc = true;

    while (continueCalc) {
        std::cout << "\n简单计算器\n";
        std::cout << "请输入第一个数字: ";
        std::cin >> num1;

        std::cout << "请输入运算符 (+, -, *, /): ";
        std::cin >> op;

        std::cout << "请输入第二个数字: ";
        std::cin >> num2;

        double result;
        bool valid = true;

        switch (op) {
            case '+':
                result = num1 + num2;
                break;
            case '-':
                result = num1 - num2;
                break;
            case '*':
                result = num1 * num2;
                break;
            case '/':
                if (num2 != 0) {
                    result = num1 / num2;
                } else {
                    std::cout << "错误：除数不能为0！\n";
                    valid = false;
                }
                break;
            default:
                std::cout << "错误：无效运算符！\n";
                valid = false;
        }

        if (valid) {
            std::cout << "结果: " << num1 << " " << op << " "
                      << num2 << " = " << result << "\n";
        }

        // 询问是否继续
        char choice;
        std::cout << "是否继续计算？(y/n): ";
        std::cin >> choice;

        if (choice != 'y' && choice != 'Y') {
            continueCalc = false;
        }
    }

    std::cout << "感谢使用！\n";
    return 0;
}
```

### 示例2：猜数字游戏

```cpp
#include <iostream>
#include <cstdlib>
#include <ctime>

int main() {
    // 初始化随机数种子
    std::srand(std::time(0));

    // 生成1-100之间的随机数
    int secretNumber = std::rand() % 100 + 1;
    int guess = 0;
    int attempts = 0;

    std::cout << "欢迎来到猜数字游戏！\n";
    std::cout << "我已经想好了一个1-100之间的数字。\n";

    // 游戏循环
    while (guess != secretNumber) {
        std::cout << "请输入你的猜测: ";
        std::cin >> guess;
        attempts++;

        if (guess < secretNumber) {
            std::cout << "太小了！再试一次。\n";
        } else if (guess > secretNumber) {
            std::cout => "太大了！再试一次。\n";
        }
    }

    std::cout << "\n恭喜你！猜对了！\n";
    std::cout << "你用了" << attempts << "次猜中。\n";

    return 0;
}
```

### 示例3：打印图案

```cpp
#include <iostream>

int main() {
    int size = 5;

    // 打印直角三角形
    std::cout << "直角三角形:\n";
    for (int i = 1; i <= size; i++) {
        for (int j = 1; j <= i; j++) {
            std::cout << "*";
        }
        std::cout << "\n";
    }

    // 打印倒三角形
    std::cout << "\n倒三角形:\n";
    for (int i = size; i >= 1; i--) {
        for (int j = 1; j <= i; j++) {
            std::cout << "*";
        }
        std::cout << "\n";
    }

    // 打印等腰三角形
    std::cout << "\n等腰三角形:\n";
    for (int i = 1; i <= size; i++) {
        // 打印空格
        for (int j = 1; j <= size - i; j++) {
            std::cout << " ";
        }
        // 打印星号
        for (int j = 1; j <= 2 * i - 1; j++) {
            std::cout << "*";
        }
        std::cout << "\n";
    }

    return 0;
}
```

---

## 控制流最佳实践

### 1. 避免深层嵌套

```cpp
// ❌ 不推荐：深层嵌套
if (condition1) {
    if (condition2) {
        if (condition3) {
            // 做某事
        }
    }
}

// ✅ 推荐：使用提前返回
if (!condition1) return;
if (!condition2) return;
if (!condition3) return;
// 做某事
```

### 2. 使用有意义的变量名

```cpp
// ❌ 不推荐
if (x > 5 && y < 10 && z == true) {
    // ...
}

// ✅ 推荐
bool isValid = (x > 5) && (y < 10) && (z == true);
if (isValid) {
    // ...
}
```

### 3. 避免魔法数字

```cpp
// ❌ 不推荐
if (score >= 90) {
    std::cout << "A\n";
}

// ✅ 推荐
const int EXCELLENT_THRESHOLD = 90;
if (score >= EXCELLENT_THRESHOLD) {
    std::cout << "A\n";
}
```

---

## 小结

本节介绍了C++的流程控制语句：

1. **条件语句**：
   - `if`、`if-else`、`if-else if`
   - `switch`语句
   - 合理选择if或switch

2. **循环语句**：
   - `while`：先判断后执行
   - `do-while`：先执行后判断
   - `for`：灵活的循环控制
   - 嵌套循环

3. **跳转语句**：
   - `break`：退出循环或switch
   - `continue`：跳过本次迭代
   - `goto`：谨慎使用

4. **范围for循环（C++11）**：
   - 简化遍历容器
   - 支持引用和const引用

## 练习

1. ✅ 编写程序找出1-100中的所有素数
2. ✅ 实现一个简单的菜单系统
3. ✅ 使用嵌套循环打印九九乘法表
4. ✅ 使用范围for循环处理vector中的元素

---

## 下一章
[第二章 函数与程序结构](../第二章-函数与程序结构/README.md) → 学习如何组织和重用代码。
